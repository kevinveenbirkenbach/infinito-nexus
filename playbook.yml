- name: "Execute Infinito.Nexus Play"
  hosts: all
  environment:
    CA_TRUST_CERT_HOST:     "{{ CA_TRUST.cert_host }}"
    CA_TRUST_WRAPPER_HOST:  "{{ CA_TRUST.wrapper_host }}"
    CA_TRUST_NAME:          "{{ CA_TRUST.trust_name }}"
  tasks:
  - name: "Load 'constructor' tasks"
    include_tasks: "tasks/stages/01_constructor.yml"

  - name: Load host-type stages
    ansible.builtin.include_tasks: "tasks/stages/02_{{ item }}.yml"
    loop: "{{ group_names | get_deployment_types_from_groups }}"

  - name: "Load 'destructor' tasks"
    include_tasks: "tasks/stages/03_destructor.yml"
  become: true
