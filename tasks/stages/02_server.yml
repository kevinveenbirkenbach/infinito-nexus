---
- name: Setup server base
  include_role:
    name: "{{ item }}"
  loop:
    - user-administrator
    - user-root
    - sys-svc-sshd
    - sys-svc-journalctl
    - sys-ctl-hlth-disc-space
    - sys-ctl-cln-disc-space
    - sys-ctl-hlth-btrfs
    - sys-ctl-rpr-btrfs-balancer

- name: "Include server roles"
  include_tasks: "./tasks/groups/{{ item }}-roles.yml"
  loop:
    - web-svc   # 1. Load web server services
    - web-app   # 2. Load (UI) web applications
    - web-opt   # 4. Load optimation scrips last
  loop_control:
    label: "{{ item }}-roles.yml"

- name: Run E2E Cypress tests
  include_role:
    name: "test-e2e-cypress"
  when: 
    - DOCKER_IN_CONTAINER | bool
    - MODE_TEST | bool
