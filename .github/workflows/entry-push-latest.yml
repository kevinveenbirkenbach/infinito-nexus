name: CI (Push)

concurrency:
  group: global-ci-${{ github.repository }}-${{ github.ref_name }}
  cancel-in-progress: false

on:
  push:
    branches:
      - "**"

permissions:
  contents: read
  packages: write
  security-events: write

jobs:
  pick-distro:
    name: ðŸŽ² Pick random distro
    runs-on: ubuntu-latest
    outputs:
      distro: ${{ steps.pick.outputs.distro }}
    steps:
      - id: pick
        shell: bash
        run: |
          set -euo pipefail
          distros=(arch debian ubuntu fedora centos)
          one="$(printf "%s\n" "${distros[@]}" | shuf -n 1)"
          echo "distro=${one}" >> "$GITHUB_OUTPUT"
          echo "=== Picked distro: ${one} ==="

  ci-orchestrator:
    name: ðŸŽ¶ Orchestra CI/CD
    needs: pick-distro
    uses: ./.github/workflows/ci-orchestrator.yml
    with:
      # ci-orchestrator expects a space-separated list â†’ give it exactly one
      distros: ${{ needs.pick-distro.outputs.distro }}
