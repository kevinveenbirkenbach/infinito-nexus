- block:
    - name: Install '{{ SYS_CTL_CLN_ANON_VOLUMES_COMMAND }}'
      include_role:
        name: sys-pip-install
      vars:
        sys_pip_install_package: '{{ SYS_CTL_CLN_ANON_VOLUMES_COMMAND }}'

    - name: Show which python/pip are used and where they install (system python)
      ansible.builtin.command:
        argv:
          - /bin/bash
          - -c
          - |
            set -euo pipefail

            PY="/usr/bin/python3"
            echo "== python =="
            command -v "$PY" || true
            "$PY" -c 'import sys; print("executable:", sys.executable); print("prefix:", sys.prefix); print("base_prefix:", sys.base_prefix)'

            echo "== pip =="
            "$PY" -m pip --version

            echo "== scripts dir =="
            "$PY" -c 'import sysconfig; print(sysconfig.get_path("scripts"))'

            echo "== dockreap package =="
            "$PY" -m pip show -f dockreap | head -n 80

            echo "== dockreap binary resolution =="
            command -v dockreap || true
            ls -l "$("$PY" -c 'import sysconfig; print(sysconfig.get_path("scripts"))')/dockreap" || true
      changed_when: false
      become: true

    - include_role:
        name: sys-service
      vars:
        system_service_tpl_on_failure:      "{{ SYS_SERVICE_ON_FAILURE_COMPOSE }}"
        system_service_tpl_exec_start:      '{{ SYS_CTL_CLN_ANON_VOLUMES_COMMAND }} --no-confirmation'
        system_service_tpl_exec_start_pre:  "" # Anonymous volumes can allways be removed. It isn't necessary to wait for any service to stop.
        system_service_copy_files:          false
        system_service_force_linear_sync:   false

    - include_tasks: utils/once/flag.yml
  when: run_once_sys_ctl_cln_anon_volumes is not defined
