---
- name: "load docker, db and proxy for {{ application_id }}"
  include_role:
    name: sys-stk-full-stateful
  vars:
    docker_compose_flush_handlers:  false
    docker_repository_address:      "https://github.com/taigaio/taiga-docker"
    docker_pull_git_repository:     true

- name: "copy templates {{ TAIGA_SETTING_FILES }} for taiga-contrib-oidc-auth"
  template:
    src:  "taiga/{{ item }}.py.j2"
    dest: "{{ [ docker_compose.directories.config, 'taiga-' ~ item ~ '.py'] | path_join }}"
  when:   TAIGA_TAIGAIO_ENABLED | bool
  notify: docker compose up
  loop:   "{{ TAIGA_SETTING_FILES }}"

- name: "create {{ TAIGA_DOCKER_COMPOSE_INIT_PATH }}"
  template:
    src:  "docker-compose-inits.yml.j2"
    dest:  "{{ TAIGA_DOCKER_COMPOSE_INIT_PATH }}"
  notify: docker compose up

- name: "Flush Taiga handlers"
  meta: flush_handlers

- name: "Include Taiga administrator routines"
  include_tasks: 01_administrator.yml