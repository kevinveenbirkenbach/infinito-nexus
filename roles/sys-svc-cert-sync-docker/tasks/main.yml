- block:
  - include_tasks: 01_core.yml
  - set_fact:
      run_once_sys_svc_cert_sync_docker: true
  when: run_once_sys_svc_cert_sync_docker is not defined

- name: "create {{ cert_mount_directory }}"
  file:
    path: "{{ cert_mount_directory }}"
    state: directory
    mode: "0755"
  notify: restart tls deploy to docker service

- name: Copy {{ CERT_SYNC_DOCKER_SERVICE_NAME_FULL }}
  template:
    src: "{{ CERT_SYNC_DOCKER_BASE }}.service.j2"
    dest: "/etc/systemd/system/{{ CERT_SYNC_DOCKER_SERVICE_NAME_FULL }}"
  notify: restart tls deploy to docker service

- name: "include role for sys-timer for {{ CERT_SYNC_DOCKER_SERVICE_NAME_FULL }}"
  include_role:
    name: sys-timer
  vars:
    on_calendar: "{{ on_calendar_deploy_certificates }}"
    service_name: "{{ CERT_SYNC_DOCKER_SERVICE_NAME_BASE }}"
    persistent: "true"

