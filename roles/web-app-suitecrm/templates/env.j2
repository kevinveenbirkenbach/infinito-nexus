#############################################
# SuiteCRM Docker Environment (.env)
# Built for Infinito.Nexus Roles
#############################################

# ------------------------------------------------
# Core Symfony / SuiteCRM 8 settings
# ------------------------------------------------
APP_ENV={{ 'dev' if (ENVIRONMENT | lower) == 'development' else 'prod' }}
APP_DEBUG="{{ MODE_DEBUG | bool| ternary(1, 0) }}"

# ------------------------------------------------
# Database (Symfony-style)
# ------------------------------------------------
DATABASE_URL=mysql://{{ database_username }}:{{ database_password | urlencode }}@{{ database_host }}:{{ database_port }}/{{ database_name }}
DATABASE_DRIVER=pdo_mysql
DATABASE_SERVER_VERSION=10.11

# Keep legacy-style vars for external tools or debugging
SUITECRM_DB_HOST={{ database_host }}
SUITECRM_DB_PORT={{ database_port }}
SUITECRM_DB_NAME={{ database_name }}
SUITECRM_DB_USER={{ database_username }}
SUITECRM_DB_PASSWORD={{ database_password }}

# ------------------------------------------------
# Initial admin account (for your own tooling)
# ------------------------------------------------
SUITECRM_ADMIN_USERNAME={{ applications | get_app_conf(application_id, 'users.administrator.username') }}
SUITECRM_ADMIN_PASSWORD={{ applications | get_app_conf(application_id, 'credentials.administrator_password') }}
SUITECRM_ADMIN_EMAIL={{ users['administrator'].email }}

# Public base URL of the SuiteCRM instance
SUITECRM_URL={{ SUITECRM_URL }}

# ------------------------------------------------
# SMTP (Mailu)
# ------------------------------------------------
SUITECRM_SMTP_HOST={{ SYSTEM_EMAIL.HOST }}
SUITECRM_SMTP_PORT={{ SYSTEM_EMAIL.PORT }}
SUITECRM_SMTP_USER={{ users['contact'].email }}
SUITECRM_SMTP_PASSWORD={{ users['contact'].mailu_token }}
SUITECRM_SMTP_PROTOCOL={{ "TLS" if SYSTEM_EMAIL.START_TLS else "SSL" }}
SUITECRM_EMAIL_FROM_NAME={{ applications | get_app_conf(application_id, 'email.from_name') }}

# ------------------------------------------------
# LDAP settings (native SuiteCRM 8 / Symfony)
# ------------------------------------------------
{% if SUITECRM_LDAP_ENABLED | bool %}
AUTH_TYPE=ldap
LDAP_HOST={{ LDAP.SERVER.DOMAIN }}
LDAP_PORT={{ LDAP.SERVER.PORT }}
LDAP_ENCRYPTION={{ LDAP.SERVER.SECURITY | lower if LDAP.SERVER.SECURITY else "none" }}   # none|ssl|tls
LDAP_BASE_DN={{ LDAP.DN.OU.USERS }}
LDAP_BIND_DN={{ LDAP.DN.ADMINISTRATOR.DATA }}
LDAP_BIND_PASSWORD={{ LDAP.BIND_CREDENTIAL }}
LDAP_UID_KEY={{ LDAP.USER.ATTRIBUTES.ID }}   # e.g. uid or mail
{% else %}
AUTH_TYPE=disabled
{% endif %}

# ------------------------------------------------
# Maintenance mode toggle
# ------------------------------------------------
SUITECRM_MAINTENANCE={{ SUITECRM_INIT_MAINTENANCE_MODE | lower }}
