#############################################
# SuiteCRM Docker Environment (.env) â€“ ENGLISH
# Based on bitnami/suitecrm environment variables
#############################################

# ------------------------------------------------
# Database connection (Bitnami-style)
# ------------------------------------------------
MARIADB_HOST={{ database_host }}
MARIADB_PORT={{ database_port }}
MARIADB_USER={{ database_username }}
MARIADB_PASSWORD={{ database_password }}

# ------------------------------------------------
# Initial admin account
# ------------------------------------------------
SUITECRM_USERNAME={{ applications | get_app_conf(application_id, 'users.administrator.username') }}
SUITECRM_PASSWORD={{ applications | get_app_conf(application_id, 'credentials.administrator_password') }}
SUITECRM_EMAIL={{ users['contact'].email }}
SUITECRM_HOST={{ domains | get_domain(application_id) }}

# ------------------------------------------------
# Logger / basic options
# (SuiteCRM/Bitnami will log to stdout/stderr by default)
# ------------------------------------------------

# ------------------------------------------------
# System SMTP settings
# ------------------------------------------------
SUITECRM_SMTP_HOST={{ SYSTEM_EMAIL.HOST }}
SUITECRM_SMTP_PORT={{ SYSTEM_EMAIL.PORT }}
SUITECRM_SMTP_USER={{ users['contact'].email }}
SUITECRM_SMTP_PASSWORD={{ users['contact'].mailu_token }}
SUITECRM_SMTP_PROTOCOL={{ "TLS" if SYSTEM_EMAIL.START_TLS else "SSL" }}

# ------------------------------------------------
# LDAP settings (native SuiteCRM 8+ via Symfony)
# Applied only if the feature flag is true
# ------------------------------------------------
{% if applications | get_app_conf(application_id, 'features.ldap') %}
AUTH_TYPE=ldap

# Base LDAP connection
LDAP_HOST={{ LDAP.SERVER.DOMAIN }}
LDAP_PORT={{ LDAP.SERVER.PORT }}
# Allowed values: none, tls, ssl (see SuiteCRM docs)
LDAP_ENCRYPTION={{ LDAP.SERVER.SECURITY | lower if LDAP.SERVER.SECURITY else "none" }}
LDAP_PROTOCOL_VERSION=3
LDAP_REFERRALS=false

# DN / search configuration
LDAP_DN_STRING='{{ LDAP.USER.ATTRIBUTES.ID }}={username},{{ LDAP.DN.OU.USERS }}'
LDAP_QUERY_STRING=''
LDAP_SEARCH_DN={{ LDAP.DN.ADMINISTRATOR.DATA }}
LDAP_SEARCH_PASSWORD={{ LDAP.BIND_CREDENTIAL }}

# Auto-create SuiteCRM users from LDAP
LDAP_AUTO_CREATE=enabled
LDAP_PROVIDER_BASE_DN={{ LDAP.DN.OU.USERS }}
LDAP_PROVIDER_SEARCH_DN={{ LDAP.DN.ADMINISTRATOR.DATA }}
LDAP_PROVIDER_SEARCH_PASSWORD={{ LDAP.BIND_CREDENTIAL }}
LDAP_PROVIDER_DEFAULT_ROLES=ROLE_USER
LDAP_PROVIDER_UID_KEY={{ LDAP.USER.ATTRIBUTES.ID }}
LDAP_PROVIDER_FILTER='({{ LDAP.USER.ATTRIBUTES.ID }}={username})'
{% endif %}

# ------------------------------------------------
# OpenID Connect settings (platform / plugin level)
# Applied only if the feature flag is true
# ------------------------------------------------
{% if SUITECRM_OIDC_ENABLED | bool %}
SUITECRM_OIDC_CLIENT_ID={{ OIDC.CLIENT.ID }}
SUITECRM_OIDC_CLIENT_SECRET={{ OIDC.CLIENT.SECRET }}

SUITECRM_OIDC_ISSUER_URL={{ OIDC.CLIENT.ISSUER_URL }}
SUITECRM_OIDC_AUTHORIZATION_ENDPOINT={{ OIDC.CLIENT.AUTHORIZE_URL }}
SUITECRM_OIDC_TOKEN_ENDPOINT={{ OIDC.CLIENT.TOKEN_URL }}
SUITECRM_OIDC_USER_INFO_ENDPOINT={{ OIDC.CLIENT.USER_INFO_URL }}
SUITECRM_OIDC_JWKS_ENDPOINT={{ OIDC.CLIENT.CERTS }}

SUITECRM_OIDC_REDIRECT_URI={{ SUITECRM_URL }}/oidc/callback
SUITECRM_OIDC_SCOPES=openid,profile,email
{% endif %}
