- name: Define hostname package per distro
  ansible.builtin.set_fact:
    hostname_package: >-
      {{
        'inetutils' if ansible_facts.os_family == 'Archlinux' else
        'hostname'
      }}

- block:
  - name: Set system hostname to inventory_hostname (FQDN recommended)
    ansible.builtin.hostname:
      name: "{{ inventory_hostname }}"

  - name: Ensure /etc/hosts contains FQDN + shortname mapping
    ansible.builtin.lineinfile:
      path: /etc/hosts
      regexp: '^127\.0\.1\.1\s+'
      line: "127.0.1.1 {{ inventory_hostname }}.localdomain {{ inventory_hostname }}"
      create: true
  when: not DOCKER_IN_CONTAINER | bool

- include_tasks: utils/once/flag.yml
