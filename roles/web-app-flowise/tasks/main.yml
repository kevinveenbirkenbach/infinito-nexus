---
- name: "Install Ollama Dependency"
  include_role:
    name: svc-ai-ollama
  vars:
    flush_handlers: true
  when:    
    - run_once_svc_ai_ollama is not defined
    - OLLAMA_LOCAL_ENABLED | bool

- name: "load docker and db for {{ application_id }}"
  include_role:
    name: sys-stk-back-stateless
  vars:
    docker_compose_flush_handlers: false

- name: "create {{ FLOWISE_LITELLM_CONFIG_PATH_HOST }}"
  template:
    src:  "litellm.config.yaml.j2" 
    dest: "{{ FLOWISE_LITELLM_CONFIG_PATH_HOST }}"
  notify: docker compose up

- name: "flush handlers of docker compose"
  meta: flush_handlers

- name: "Include role sys-stk-front-proxy for '{{ application_id }}'"
  include_role:
    name: sys-stk-front-proxy
  vars:
    domain:     "{{ domains | get_domain(application_id) }}"
    http_port:  "{{ ports.localhost.http[application_id] }}"
