- name: "load docker, db and proxy for {{ application_id }}"
  include_role: 
    name: sys-stk-full-stateful
  vars:
    docker_compose_flush_handlers: false
    proxy_extra_configuration: "sub_filter '{{MYBB_DOMAIN}}' '{{ MYBB_DOMAIN }}';"

- name: "create {{ MYBB_NGINX_CONF_DIR_HOST }} and parent directories"
  file:
    path: "{{ MYBB_NGINX_CONF_DIR_HOST }}"
    state: directory
    mode: "0755"
    recurse: yes

- name: "Deploy {{ MYBB_NGINX_DEFAULT_CONF_HOST }}"
  template:
    src: "default.conf.j2"
    dest: "{{ MYBB_NGINX_DEFAULT_CONF_HOST }}"
  notify: docker compose up

- name: "Deploy {{ MYBB_CONFIG_HOST_PATH }}"
  template:
    src: "config.php.j2"
    dest: "{{ MYBB_CONFIG_HOST_PATH }}"
    mode: '0644'