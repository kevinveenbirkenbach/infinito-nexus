- block:
    - name: Stop and disable postfix if present (avoid port 25 conflicts)
      service:
        name: postfix
        state: stopped
        enabled: false
      failed_when: false

    - name: Remove postfix when external SMTP is used (conflicts with msmtp-mta)
      package:
        name:
          - postfix
          - postfix-lmdb
        state: absent
  when: SYSTEM_EMAIL_EXTERNAL | bool
