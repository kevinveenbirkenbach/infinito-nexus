- name: "Keycloak | Sync LDAP groups (ldap-roles mapper)"
  ansible.builtin.shell: >
    {{ KEYCLOAK_EXEC_KCADM }} create
    user-storage/{{ ldap_cmp_id.stdout | trim }}/mappers/{{ grp_mapper_id | trim }}/sync?direction=fedToKeycloak
    -r {{ KEYCLOAK_REALM }}
  register: group_sync
  changed_when: true
  failed_when: group_sync.rc != 0
  no_log: "{{ MASK_CREDENTIALS_IN_LOGS | bool }}"
  async: "{{ ASYNC_TIME if ASYNC_ENABLED | bool else omit }}"
  poll:  "{{ ASYNC_POLL if ASYNC_ENABLED | bool else omit }}"
