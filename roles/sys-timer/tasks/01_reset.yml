- name: Find all {{ SYS_SERVICE_SUFFIX }} units
  find:
    paths: /etc/systemd/system
    patterns: '*.{{ SYS_SERVICE_SUFFIX }}'
  register: infinito_timers

- name: Disable and stop each infinito timer
  systemd:
    name: "{{ item.path | basename }}"
    enabled: no
    state: stopped
  loop: "{{ infinito_timers.files }}"
  loop_control:
    label: "{{ item.path | basename }}"

- name: Remove all {{ SYS_SERVICE_SUFFIX }} files
  file:
    path: "{{ item.path }}"
    state: absent
  loop: "{{ infinito_timers.files }}"
  loop_control:
    label: "{{ item.path | basename }}"

- name: Reload systemd daemon
  command: systemctl daemon-reload
  become: true
