- name: "load docker, proxy for '{{ application_id }}'"
  include_role:
    name: sys-stk-full-stateless
  vars:
    docker_compose_flush_handlers:  false
    docker_git_repository_address:      "{{ LITTLEJS_REPOSITORY_BASE }}.git"
    docker_git_repository_pull:     true
    docker_git_repository_branch:       "main"

- name: "Load LittleJS example metadata"
  include_vars:
    file: "examples.yml"

- name: "Render LittleJS index.html"
  template:
    src:  "html/index.html.j2"
    dest: "{{ LITTLEJS_INDEX_HOST_ABS }}"
    mode: "0644"
  notify:
    - docker compose build
    - docker compose up

- name: "Render LittleJS run.html for shorts"
  template:
    src:  "html/run.html.j2"
    dest: "{{ LITTLEJS_RUN_HOST_ABS }}"
    mode: "0644"
  notify:
    - docker compose build
    - docker compose up

- name: "flush docker compose for '{{ application_id }}'"
  meta: flush_handlers

- include_tasks: utils/once/finalize.yml
