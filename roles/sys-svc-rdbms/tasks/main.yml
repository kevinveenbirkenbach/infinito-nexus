# run_once_sys_svc_rdbms: deactivated

# The following env file will just be used from the dedicated mariadb container
# and not the central one
- block:
  - name: "Ensure env dir exists: {{ docker_compose.directories.env }}"
    ansible.builtin.file:
      path: "{{ docker_compose.directories.env }}"
      state: directory
      mode: "0755"
  - name: "For '{{ application_id }}': Create {{ database_env }}"
    template:
      src: "env/{{ database_type }}.env.j2"
      dest: "{{ database_env }}"
    notify: docker compose up
  when: not (SYS_SVC_RDBMS_CENTRAL_DB_ENABLED | bool)

- name: "For '{{ application_id }}': Create central database"
  # I don't know why this includes leads to that the application_id in vars/main.yml of the database role isn't used
  # This is the behaviour which I want, but I'm still wondering why ;)
  include_role:
    name: "svc-db-{{ database_type }}"
  when: SYS_SVC_RDBMS_CENTRAL_DB_ENABLED | bool
  vars:
    database_init:              true  # Initialize a custom database for the application
    docker_git_repository_pull: false # Deactivated here to don't inhire the variable

- name: "For '{{ application_id }}': Add Entry for Backup Procedure"
  include_tasks: "{{ playbook_dir }}/roles/sys-ctl-bkp-docker-2-loc/tasks/04_seed-database-to-backup.yml"
