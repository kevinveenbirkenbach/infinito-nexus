# General
application_id:                 "web-app-openproject"

# Database
database_type:                  "postgres"

# Open Project Specific
openproject_version:            "{{ applications | get_app_conf(application_id, 'docker.services.web.version') }}"
openproject_image:              "{{ applications | get_app_conf(application_id, 'docker.services.web.image') }}"
openproject_volume:             "{{ applications | get_app_conf(application_id, 'docker.volumes.data') }}"
openproject_web_name:           "{{ applications | get_app_conf(application_id, 'docker.services.web.name') }}"
openproject_seeder_name:        "{{ applications | get_app_conf(application_id, 'docker.services.seeder.name') }}"
openproject_cron_name:          "{{ applications | get_app_conf(application_id, 'docker.services.cron.name') }}"
openproject_proxy_name:         "{{ applications | get_app_conf(application_id, 'docker.services.proxy.name') }}"
openproject_worker_name:        "{{ applications | get_app_conf(application_id, 'docker.services.worker.name') }}"

# Open Project Cache
openproject_cache_name:         "{{ applications | get_app_conf(application_id, 'docker.services.cache.name') }}"
openproject_cache_image:        "{{ applications
     | get_app_conf(application_id, 'docker.services.cache.image')
     or applications
       | get_app_conf('svc-db-memcached', 'docker.services.memcached.image')
  }}"

openproject_cache_version: "{{ applications
     | get_app_conf(application_id, 'docker.services.cache.version')
     or applications
       | get_app_conf('svc-db-memcached', 'docker.services.memcached.version')
  }}"

      
openproject_plugins_folder:   "{{ docker_compose.directories.volumes }}plugins/"

openproject_custom_image:     "custom_openproject"

# The following volume doesn't have a practcical function. It just exist to prevent the creation of unnecessary anonymous volumes
openproject_dummy_volume:     "{{ docker_compose.directories.volumes }}dummy_volume"

openproject_rails_settings:
  email_delivery_method:      "smtp"
  smtp_address:               "{{ SYSTEM_EMAIL.HOST }}"
  smtp_domain:                "{{ SYSTEM_EMAIL.DOMAIN }}"
  smtp_user_name:             "{{ users['no-reply'].email }}"
  smtp_password:              "{{ users['no-reply'].mailu_token }}"
  smtp_ssl:                   false

openproject_filters:
  administrators: "{{ '(memberOf=cn=openproject-admins,' ~ LDAP.DN.OU.ROLES ~ ')' 
       if applications | get_app_conf(application_id, 'ldap.filters.administrators') else '' }}"

  users: "{{ '(memberOf=cn=openproject-users,' ~ LDAP.DN.OU.ROLES ~ ')' 
       if applications | get_app_conf(application_id, 'ldap.filters.users') else '' }}"

# Docker
docker_repository_branch:       "stable/{{ openproject_version }}"
docker_repository_address:      "https://github.com/opf/openproject-deploy"
docker_pull_git_repository:     true
docker_compose_flush_handlers:  false