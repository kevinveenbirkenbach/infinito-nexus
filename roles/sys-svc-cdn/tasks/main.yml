---
- block:
    - include_tasks: 01_core.yml
  when:
    - run_once_sys_svc_cdn is not defined

- name: Ensure CDN directories exist
  file:
    path:  "{{ item }}"
    state: directory
    owner: "{{ NGINX.USER }}"
    group: "{{ NGINX.USER }}"
    mode:  "0755"
  loop: "{{ cdn_dirs_role }}"

- name: Ensure 'latest' symlink points to current release
  file:
    src:   "{{ cdn_paths_all.role.release.root }}"
    dest:  "{{ [cdn_paths_all.role.root, 'latest'] | path_join }}"
    state: link
    force: true
  when: CDN_VERSION != 'latest'
