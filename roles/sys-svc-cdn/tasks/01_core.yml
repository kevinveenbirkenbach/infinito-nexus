- name: "Load CDN for '{{ domain }}'"
  include_role:
    name: web-svc-cdn
    public: false
  when:
  - application_id != 'web-svc-cdn'
  - run_once_web_svc_cdn is not defined

- name: Overwritte CDN handlers with neutral handlers
  ansible.builtin.include_tasks: "{{ [ playbook_dir, 'tasks/utils/load_handlers.yml'] | path_join }}"
  loop:
  - svc-prx-openresty
  - docker-compose
  loop_control:
    label: "{{ item }}"
  vars:
    handler_role_name: "{{ item }}"

# ------------------------------------------------------------------
# Only-once creations (shared root and vendor)
# ------------------------------------------------------------------
- name: Ensure shared root and vendor exist (run once)
  ansible.builtin.file:
    path:  "{{ item }}"
    state: directory
    owner: "{{ NGINX.USER }}"
    group: "{{ NGINX.USER }}"
    mode:  "0755"
  loop: "{{ CDN_DIRS_GLOBAL }}"

- include_tasks: utils/run_once.yml