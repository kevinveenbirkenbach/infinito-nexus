---
- name: "Akaunting | Check if first run (marker exists?)"
  ansible.builtin.stat:
    path: "{{ AKAUNTING_SETUP_MARKER }}"
  register: akaunting_marker_stat

- name: "Akaunting | Decide if setup should be enabled"
  ansible.builtin.set_fact:
    akaunting_setup_enabled: "{{ not akaunting_marker_stat.stat.exists }}"

- name: "For '{{ application_id }}': load docker, db and proxy"
  include_role:
    name: sys-stk-full-stateful
  vars:
    docker_git_repository_address:        "https://github.com/akaunting/docker.git"
    docker_git_repository_pull:           true
    docker_git_repository_branch:         "master"
    docker_compose_file_creation_enabled: true
    docker_compose_flush_handlers:        true

- name: "Akaunting | Create first-run marker to disable future setup"
  ansible.builtin.file:
    path: "{{ AKAUNTING_SETUP_MARKER }}"
    state: touch
    mode: "0644"
  when: akaunting_setup_enabled | bool
