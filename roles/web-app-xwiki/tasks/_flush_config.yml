- name: "Render xwiki.cfg"
  template:
    src: "xwiki.cfg.j2"
    dest: "{{ XWIKI_HOST_CONF_PATH }}"
  notify: docker compose up

- name: "Deploy xwiki.properties"
  template:
    src: "xwiki.properties.j2"
    dest: "{{ XWIKI_HOST_PROPERTIES_PATH }}"
  notify: docker compose up

- name: "flush docker compose for '{{ application_id }}'"
  meta: flush_handlers

- name: "Wait until XWiki REST is ready"
  uri:
    url: "{{ XWIKI_REST_BASE }}"
    status_code: [200, 401, 302]
    return_content: no
  changed_when: false
  register: xwiki_rest_up
  retries: 60
  delay: 5
  until: xwiki_rest_up is succeeded