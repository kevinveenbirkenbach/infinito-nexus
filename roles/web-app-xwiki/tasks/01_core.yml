- name: Validate XWiki variables
  include_tasks: 02_validation.yml

- name: "load docker, db and proxy for {{ application_id }}"
  include_role: 
    name: sys-stk-full-stateful
  vars:
    docker_compose_flush_handlers: false

- name: Deploy Bootstrap Config
  include_tasks: _flush_config.yml
  vars:
    xwiki_oidc_enabled_switch:        false
    xwiki_ldap_enabled_switch:        false
    xwiki_superadmin_enabled_switch:  true

- name: Load setup procedures for admin
  include_tasks: 03_administrator.yml
  when: not (XWIKI_SSO_ENABLED | bool)

- name: Load setup procedures for extensions
  include_tasks: 04_extensions.yml

- name: Deploy Final Config
  include_tasks: _flush_config.yml
  vars:
    xwiki_oidc_enabled_switch:        "{{ XWIKI_OIDC_ENABLED | bool }}"
    xwiki_ldap_enabled_switch:        "{{ XWIKI_LDAP_ENABLED | bool }}"
    xwiki_superadmin_enabled_switch:  false

- include_tasks: utils/run_once.yml
