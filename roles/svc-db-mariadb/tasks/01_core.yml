- name: "Setup docker network for {{ application_id }}"
  include_tasks: "{{ [playbook_dir, 'roles/docker-compose/tasks/utils/network.yml' ] | path_join }}"
  vars:
    docker_network_name:            "{{ MARIADB_NETWORK }}"
    docker_network_subnet:          "{{ MARIADB_SUBNET }}"
    docker_compose_flush_handlers:  true

- name: install python-mysqlclient
  community.general.pacman: 
    name: python-mysqlclient
    state: present

- name: "Wait until the MariaDB container with hostname '{{ MARIADB_NAME }}' is healthy"
  community.docker.docker_container_info:
    name: "{{ MARIADB_NAME }}"
  register: db_info
  until:
  - db_info.container is defined
  - db_info.container.State.Health.Status == "healthy"
  retries: 30
  delay: 5

- include_tasks: utils/once/flag.yml
