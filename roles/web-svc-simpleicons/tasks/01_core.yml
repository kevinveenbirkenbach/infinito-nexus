- name: "load docker, proxy for '{{ application_id }}'"
  include_role:
    name: sys-stk-full-stateless
  vars:
    aca_origin:               "* always"
    aca_methods:              "'GET, OPTIONS' always"
    aca_headers:              '"Origin, X-Requested-With, Content-Type, Accept, Authorization" always'
    webserver_vhost_flavour:  "basic"

- name: "Copy '{{ application_id }}' files"
  template:
    src: "{{ item.source }}"
    dest: "{{ item.target }}"
    mode: '0755'
  loop:
    - { source: "server.js.j2",     target: "{{ simpleicons_host_server_file }}" }
    - { source: "package.json.j2",  target: "{{ simpleicons_host_package_file }}" }
  notify:
    - docker compose up

- meta: flush_handlers

- include_tasks: utils/once/flag.yml