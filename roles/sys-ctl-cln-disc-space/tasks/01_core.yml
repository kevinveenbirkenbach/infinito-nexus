- name: Include dependencies
  include_role:
    name: '{{ item }}'
  loop:
  - sys-ctl-alm-compose
  - sys-lock

- include_role:
    name: sys-service
  vars:
    system_service_timer_enabled:       true
    system_service_copy_files:          true
    system_service_on_calendar:         "{{ SYS_SCHEDULE_CLEANUP_DISC_SPACE }}"
    system_service_tpl_on_failure:      "{{ SYS_SERVICE_ON_FAILURE_COMPOSE }}"
    system_service_tpl_exec_start:      "{{ system_service_script_exec }} {{ SIZE_PERCENT_CLEANUP_DISC_SPACE }}"
    system_service_tpl_exec_start_pre:  '/usr/bin/python {{ PATH_SYSTEM_LOCK_SCRIPT }} {{ SYS_SERVICE_GROUP_MANIPULATION | join(" ")  }} --ignore {{ SYS_SERVICE_GROUP_CLEANUP | join(" ") }} --timeout "{{ SYS_TIMEOUT_BACKUP_SERVICES }}"'
    system_service_force_linear_sync:   false

- include_tasks: utils/once_finalize.yml