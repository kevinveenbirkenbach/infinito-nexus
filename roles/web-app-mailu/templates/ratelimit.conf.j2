# AUTOGENERATED by Ansible â€“ Rspamd ratelimits
# Mount path in container: /overrides/ratelimit.conf  (read-only)

rates {
  {# Optional global defaults for authenticated SMTP senders #}
  authenticated = {
    bucket = [{
      burst = {{ MAILU_RSPAMD_LIMITS_DEFAULTS.BURST | int }};
      rate  = "{{ MAILU_RSPAMD_LIMITS_DEFAULTS.RATE }}";
    }];
  }

  {# Per-user limits: require both .limits.rate and .limits.burst #}
  {% for uname, u in users.items() %}
    {% if (u.limits.rate | default(false) and u.limits.burst | default(false)) %}
  "user={{ u.email }}" = {
    bucket = [{
      burst = {{ u.limits.burst | int }};
      rate  = "{{ u.limits.rate }}";
    }];
  };
    {% endif %}
  {% endfor %}
}
