# General
application_id:                   "web-app-desktop"
http_port:                        "{{ ports.localhost.http[application_id] }}"

## Webserver
webserver_extra_configuration:        "{{ lookup('template', 'nginx/sso.html.conf.j2') }}"

# Desktop

## Simpleicons
DESKTOP_SIMPLEICONS_ENABLED:      "{{ lookup('config', application_id, 'compose.services.simpleicons.enabled') }}"

## Javascript
DESKTOP_JS_CDN_URL:               "{{ lookup('tls', 'web-svc-cdn', 'url.base') }}"
DESKTOP_JS_FILES:                 ['iframe.js','oidc.js']
DESKTOP_JS_BASE_PATH:             "{{ application_id | get_entity_name }}/js"
DESKTOP_JS_SERVER_DIR:            "{{ [ lookup('nginx','directories.data.cdn'), DESKTOP_JS_BASE_PATH ] | path_join }}"
DESKTOP_JS_BASE_URL:              "{{ (DESKTOP_JS_CDN_URL | trim('/')) ~ '/' ~ (DESKTOP_JS_BASE_PATH | trim('/')) }}"

## Webserver
DESKTOP_LOCATION_SILENT_CHECK:    "/silent-check-sso.html"

## Configuration
DESKTOP_CONFIG_YML_SRC_FILE:      "config.yaml.j2"
DESKTOP_CONFIG_INV_PATH:          "{{ [ inventory_dir, 'files', inventory_hostname ,'docker',application_id,DESKTOP_CONFIG_YML_SRC_FILE] | path_join }}"
DESKTOP_CONFIG_YML_DEST:          "{{ [ docker_repository_path, 'app/config.yaml'] | path_join }}"

## OIDC
DESKTOP_KEYCLOAK_LOGIN_URL: >-
  {{ OIDC.CLIENT.AUTHORIZE_URL
     ~ '?client_id=' ~ OIDC.CLIENT.ID
     ~ '&response_type=code'
     ~ '&scope=openid%20profile%20email'
     ~ '&redirect_uri=' ~ ((lookup('tls', application_id, 'url.base'))) | urlencode }}
DESKTOP_KEYCLOAK_IFRAME_ENABLED:  "{{ lookup('config','web-app-keycloak', 'compose.services.desktop.enabled') }}"
DESKTOP_OIDC_ENABLED:             "{{ lookup('config', application_id, 'compose.services.oidc.enabled') }}"

## Docker
DESKTOP_CONTAINER:                "{{ lookup('config', application_id, 'compose.services.desktop.name') }}"
DESKTOP_IMAGE:                    "{{ lookup('config', application_id, 'compose.services.desktop.image') }}"
