- name: "Execute migration for '{{ application_id }}'"
  command:
    chdir: "{{ docker_compose.directories.instance }}"
    cmd: "docker compose run --rm {{ MASTODON_SERVICE_NAME }} bundle exec rails db:migrate"

- name: "MASTODON | Seed database (idempotent)"
  command:
    chdir: "{{ docker_compose.directories.instance }}"
    cmd: "docker compose run --rm {{ MASTODON_SERVICE_NAME }} bash -lc 'bin/rails db:seed'"
  register: mastodon_seed
  changed_when: false
  failed_when: mastodon_seed.rc != 0
