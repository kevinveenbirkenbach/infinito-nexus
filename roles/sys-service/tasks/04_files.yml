
- name: "create {{ system_service_script_dir }}"
  file:
    path: "{{ system_service_script_dir }}"
    state: directory
    mode: "0755"

- name: "template or copy script"
  block:
    - name: "render template"
      template:
        src:  "{{ system_service_script_src }}"
        dest: "{{ [system_service_script_dir, (system_service_script_src | basename | regex_replace('\\.j2$', ''))] | path_join }}"
        mode: "0755"
      notify: refresh systemctl service # Just refresh service for testing that script is working in debug mode. In productive due to async it shouldn't make a difference
      when: system_service_script_src.endswith('.j2')

    - name: "copy raw file"
      copy:
        src:  "{{ system_service_script_src }}"
        dest: "{{ [system_service_script_dir, (system_service_script_src | basename)] | path_join }}"
        mode: "0755"
      when: not system_service_script_src.endswith('.j2')
      notify: refresh systemctl service # Just refresh service for testing that script is working in debug mode. In productive due to async it shouldn't make a difference
  when: system_service_copy_files | bool
