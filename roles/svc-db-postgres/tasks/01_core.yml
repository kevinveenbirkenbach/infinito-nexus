- name: Compute average allowed connections per Postgres app (once)
  set_fact:
    POSTGRES_ALLOWED_AVG_CONNECTIONS: "{{ (POSTGRES_MAX_CONNECTIONS | split_postgres_connections(playbook_dir ~ '/roles')) | int }}"
  run_once: true

- name: "Setup docker network for {{ application_id }}"
  include_tasks: "{{ [playbook_dir, 'roles/docker-compose/tasks/utils/network.yml' ] | path_join }}"
  vars:
    docker_network_name:            "{{ POSTGRES_NETWORK_NAME }}"
    docker_network_subnet:          "{{ POSTGRES_SUBNET }}"
    docker_compose_flush_handlers:  true

- name: install python-psycopg2
  package:
    name: python-psycopg2
    state: present

- include_tasks: utils/once/flag.yml