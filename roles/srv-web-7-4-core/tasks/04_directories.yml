- name: Ensure nginx configuration directories are present
  file:
    path: "{{ item }}"
    state: directory
    owner: "{{ NGINX.USER }}"
    group: "{{ NGINX.USER }}"
    mode: '0755'
    recurse: yes
  loop: >
    {{
      ( NGINX.DIRECTORIES.HTTP.values() | list ) +
      [ NGINX.DIRECTORIES.STREAMS ] 
    }}

- name: Ensure all NGINX cache directories exist
  become: true
  ansible.builtin.file:
    path: "{{ item.value }}"
    state: directory
    owner: "{{ NGINX.USER }}"
    group: "{{ NGINX.USER }}"
    mode: '0700'
  loop: "{{ NGINX.DIRECTORIES.CACHE | dict2items }}"
  loop_control:
    label: "{{ item.key }}"

- name: Ensure nginx data storage directories are present
  file:
    path: "{{ item }}"
    state: directory
    recurse: yes
    owner: "{{ NGINX.USER }}"
    group: "{{ NGINX.USER }}"
    mode:  '0755'
  loop: >
    {{ NGINX.DIRECTORIES.DATA.values() | list }}
