# General
application_id:                   "web-app-mediawiki"
container_port:                   80
entity_name:                      "{{ application_id | get_entity_name }}"

# Mediawiki
MEDIAWIKI_SITENAME:               "{{ applications | get_app_conf(application_id, 'sitename') }}"
MEDIAWIKI_URL:                    "{{ domains | get_url(application_id, WEB_PROTOCOL) }}"

## Folders
MEDIAWIKI_HTML_DIR:               "/var/www/html"
MEDIAWIKI_CONFIG_DIR:             "{{ docker_compose.directories.config }}"
MEDIAWIKI_VOLUMES_DIR:            "{{ docker_compose.directories.volumes }}"

# LocalSettings
MEDIAWIKI_LOCALSETTINGS_HOST_PATH: "{{ MEDIAWIKI_CONFIG_DIR }}/LocalSettings.php"
MEDIAWIKI_LOCALSETTINGS_CONTAINER_PATH: "{{ MEDIAWIKI_HTML_DIR }}/LocalSettings.php"

# Persistent runtime dirs
MEDIAWIKI_LOCAL_MOUNT_DIR:        "{{ [ MEDIAWIKI_VOLUMES_DIR, 'mw-local' ] | path_join }}"
MEDIAWIKI_LOCAL_PATH:             "/opt/mw-local"

## Docker
MEDIAWIKI_VERSION:                "{{ applications | get_app_conf(application_id, 'docker.services.' ~ entity_name ~ '.version') }}"
MEDIAWIKI_IMAGE:                  "{{ applications | get_app_conf(application_id, 'docker.services.' ~ entity_name ~ '.image') }}"
MEDIAWIKI_CONTAINER:              "{{ applications | get_app_conf(application_id, 'docker.services.' ~ entity_name ~ '.name') }}"
MEDIAWIKI_VOLUME_IMAGES:          "{{ applications | get_app_conf(application_id, 'docker.volumes.images') }}"
MEDIAWIKI_VOLUME_EXTENSIONS:      "{{ applications | get_app_conf(application_id, 'docker.volumes.extensions') }}"
MEDIAWIKI_USER:                   "www-data"
MEDIAWIKI_USER_GID:               "33"

MEDIAWIKI_NETWORK_DATABASE:       "{{ applications | get_app_conf('svc-db-mariadb', 'docker.network') }}"

# User and Credentials
MEDIAWIKI_ADMINISTRATOR_NAME:     "{{ users.administrator.username }}"
MEDIAWIKI_ADMINISTRATOR_PASSWORD: "{{ applications | get_app_conf(application_id, 'credentials.administrator_password') }}"
MEDIAWIKI_SECRET_KEY:             "{{ applications | get_app_conf(application_id, 'credentials.secret_key') }}"

# OIDC
MEDIAWIKI_OIDC_ENABLED:           "{{ applications | get_app_conf(application_id, 'docker.services.oidc.enabled') }}"
MEDIAWIKI_OIDC_CLIENT_ID:         "{{ OIDC.CLIENT.ID }}"
MEDIAWIKI_OIDC_CLIENT_SECRET:     "{{ OIDC.CLIENT.SECRET }}"
MEDIAWIKI_OIDC_ISSUER:            "{{ OIDC.CLIENT.ISSUER_URL }}"
MEDIAWIKI_OIDC_BUTTON_TEXT:       "{{ OIDC.BUTTON_TEXT }}"
MEDIAWIKI_OIDC_AUTOLOGIN:         true
MEDIAWIKI_OIDC_LOCALLOGIN:        false

# Extensions
MEDIAWIKI_EXT_BRANCH:             "REL{{ (MEDIAWIKI_VERSION | string).split('.')[:2] | join('_') }}"
MEDIAWIKI_EXT_CFG_BASE:           "{{ [ MEDIAWIKI_CONFIG_DIR, 'mwext', MEDIAWIKI_EXT_BRANCH ] | path_join }}"
MEDIAWIKI_EXT_LIST:
  - name: "PluggableAuth"
    url: "{{ [ 'https://codeload.github.com/wikimedia/mediawiki-extensions-PluggableAuth/tar.gz/refs/heads/',MEDIAWIKI_EXT_BRANCH ] | url_join }}"
  - name: "OpenIDConnect"
    url: "{{ [ 'https://codeload.github.com/wikimedia/mediawiki-extensions-OpenIDConnect/tar.gz/refs/heads/',MEDIAWIKI_EXT_BRANCH ] | url_join }}"
