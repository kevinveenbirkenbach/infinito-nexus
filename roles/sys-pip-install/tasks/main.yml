# run_once_sys_pip_install: disabled

- name: Include dependency 'sys-pip'
  include_role:
    name: sys-pip
  when: run_once_sys_pip is not defined

- name: Install or upgrade {{ package_name }} system-wide via pip3
  ansible.builtin.pip:
    name: "{{ package_name }}"
    state: latest
    executable: "{{'pip3' if global_install | bool else omit }}"
    extra_args: "{{'--break-system-packages' if global_install | bool else omit }}"
    virtualenv: "{{ omit if global_install | bool else (ansible_python_interpreter | dirname | dirname) }}"
  environment: "{{ {'PIP_BREAK_SYSTEM_PACKAGES': '1', 'PATH': '/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'} if global_install | bool else omit }}"
  become: "{{ true if global_install | bool else false }}"
