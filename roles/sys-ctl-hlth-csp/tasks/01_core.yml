- name: Include dependency 'sys-ctl-alm-compose'
  include_role:
    name: sys-ctl-alm-compose
  when: run_once_sys_ctl_alm_compose is not defined

- name: "pkgmgr install"
  include_role:
    name: pkgmgr-install
  vars:
    package_name: checkcsp
    package_notify: rebuild checkcsp docker image

- include_role:
    name: sys-service
  vars:
    system_service_suppress_flush:        true # The healthcheck will just work after all routines passed
    system_service_on_calendar:           "{{ SYS_SCHEDULE_HEALTH_CSP_CRAWLER }}"
    system_service_timer_enabled:         true
    system_service_tpl_on_failure:        "{{ SYS_SERVICE_ON_FAILURE_COMPOSE }}"
    system_service_tpl_timeout_start_sec: "{{ CURRENT_PLAY_DOMAINS_ALL | timeout_start_sec_for_domains }}"
    system_service_tpl_exec_start:        "{{ system_service_script_exec }} --nginx-config-dir={{ NGINX.DIRECTORIES.HTTP.SERVERS }}"

- include_tasks: utils/run_once.yml
