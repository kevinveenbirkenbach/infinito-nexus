- name: Load former meta dependencies once
  block:
  - name: Include moved dependency 'srv-web-7-4-core'
    include_role:
      name: srv-web-7-4-core
  - set_fact:
      run_once_srv_web_7_7_inj_port_ui_desktop: true
  when: run_once_srv_web_7_7_inj_port_ui_desktop is not defined
- name: "Load iFrame handler JS template for '{{ application_id }}'"
  set_fact:
    iframe_code: "{{ lookup('template','iframe-handler.js.j2') }}"

- name: "Collapse iFrame code into one-liner for '{{ application_id }}'"
  set_fact:
    iframe_code_one_liner: "{{ iframe_code | to_one_liner }}"

- name: "Append iFrame CSP hash for '{{ application_id }}'"
  set_fact:
    applications: "{{ applications | append_csp_hash(application_id, iframe_code_one_liner) }}"
  changed_when: false
