- include_tasks: utils/once/flag.yml

- include_role:
    name: sys-svc-docker
  when: run_once_sys_svc_docker is not defined

- name: Remove all docker compose pull locks
  file:
    path: "{{ PATH_DOCKER_COMPOSE_PULL_LOCK_DIR }}"
    state: absent

- name: "reset (if enabled) for {{ role_name}}"
  include_tasks: 02_reset.yml
  when: MODE_RESET | bool

- name: "create {{ PATH_DOCKER_COMPOSE_INSTANCES }}"
  file:
    path:   "{{ PATH_DOCKER_COMPOSE_INSTANCES }}"
    state:  directory
    mode:   0700
    owner:  root
    group:  root

- name: Include backup, repair and health services for docker
  include_role:
    name: "{{ item }}"
  loop:
    - sys-ctl-cln-docker
    - sys-ctl-bkp-docker-2-loc
    - sys-ctl-hlth-docker-container
    - sys-ctl-hlth-docker-volumes
    - sys-ctl-rpr-docker-hard
  when: DOCKER_COMPOSE_LOAD_SERVICES | bool
