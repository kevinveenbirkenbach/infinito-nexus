- name: "Connect '{{ DISCOURSE_CONTAINER }}' to network '{{ DISCOURSE_PG_NETWORK }}'"
  command: >
    container network connect {{ DISCOURSE_PG_NETWORK }} {{ DISCOURSE_CONTAINER }}
  register: network_connect
  failed_when: >
    network_connect.rc != 0 and
    DISCOURSE_ERROR_ALREADY_IN_NET not in network_connect.stderr
  changed_when: network_connect.rc == 0
  when:
    - lookup('database', application_id, 'shared')

- name: "Remove {{ DISCOURSE_NETWORK }} from {{ lookup('database', application_id, 'container') }}"
  command: >
    container network disconnect {{ DISCOURSE_NETWORK }} {{ lookup('database', application_id, 'container') }}
  register: network_disconnect
  failed_when: >
    network_disconnect.rc != 0 and
    DISCOURSE_ERROR_NOT_CONNECTED not in network_disconnect.stderr
  changed_when: network_disconnect.rc == 0
  when:
    - lookup('database', application_id, 'shared')