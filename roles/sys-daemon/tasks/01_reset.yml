- name: reload system daemon
  command: /bin/true
  notify: "reload system daemon"

- name: "Sanity check SYSTEMD_MANAGER_CONF_DIR"
  assert:
    that:
      - SYSTEMD_MANAGER_CONF_DIR | regex_search('^/etc/systemd/system\.conf\.d/?$')
    fail_msg: "SYSTEMD_MANAGER_CONF_DIR must be /etc/systemd/system.conf.d"
  when:
    - SYSTEMD_MANAGER_RESET_PURGE | bool
    - MODE_ASSERT | bool

- name: "Purge manager drop-in directory (remove)"
  file:
    path: "{{ SYSTEMD_MANAGER_CONF_DIR }}"
    state: absent
  notify: reexec systemd manager