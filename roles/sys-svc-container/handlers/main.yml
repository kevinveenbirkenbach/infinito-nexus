---
- name: Ensure Docker daemon is running on host
  ansible.builtin.service:
    name: docker.service
    state:  restarted
    enabled: yes
  listen: docker restart

- name: Ensure Docker-In-Docker DNS works
  ansible.builtin.script: "{{ role_path }}/files/test-dns.sh"
  listen: docker restart
  run_once: true
  when:
    - DOCKER_IN_CONTAINER | bool
    - MODE_DEBUG | bool
  environment:
    BUSYBOX_IMAGE: "{{ SYS_SVC_DOCKER_DNS_TEST_BUSYBOX_IMAGE }}"
    NODE_IMAGE: "{{ SYS_SVC_DOCKER_DNS_TEST_NODE_IMAGE }}"
