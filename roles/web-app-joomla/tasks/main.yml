---
- name: "Include role sys-stk-front-proxy for {{ application_id }}"
  include_role:
    name: sys-stk-front-proxy
  loop: "{{ JOOMLA_DOMAINS }}"
  loop_control:
    loop_var: domain
  vars:
    http_port: "{{ ports.localhost.http[application_id] }}"

- name: "load docker and db for {{ application_id }}"
  include_role:
    name: sys-stk-backend
  vars:
    docker_compose_flush_handlers: false

- name: Include PHP Config tasks
  include_tasks: 01_config.yml

- name: flush docker service
  meta: flush_handlers

- name: Include install routines
  include_tasks: "{{ item }}"
  loop:
    - 02_install.yml
    - 03_debug.yml
    - 04_patch.yml

- name: Include assert routines
  include_tasks: "05_assert.yml"
  when: MODE_ASSERT | bool

- name: Reset Admin Password
  include_tasks: 06_reset_admin_password.yml

