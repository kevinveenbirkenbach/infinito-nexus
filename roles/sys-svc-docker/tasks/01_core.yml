- name: docker & docker compose install
  community.general.pacman:
    name: 
      - 'docker'
      - 'docker-compose'
    state: present
  notify: docker restart

- name: Setup Swapfile to prevent OOM Failures
  # @ See https://en.wikipedia.org/wiki/Out_of_memory
  include_role:
    name: "svc-opt-swapfile"
  when: run_once_svc_opt_swapfile is not defined

- name: "Load reset tasks when MODE_RESET is enabled"
  include_tasks: "02_reset.yml"
  when: MODE_RESET | bool

- name: "Load cleanup tasks when MODE_CLEANUP or MODE_RESET is enabled"
  include_tasks: "03_cleanup.yml"
  when: MODE_CLEANUP | bool or MODE_RESET | bool

- name: Include backup, repair and health services for docker
  include_role:
    name: "{{ item }}"
  loop:
    - sys-ctl-bkp-docker-2-loc
    - sys-ctl-hlth-docker-container
    - sys-ctl-hlth-docker-volumes
    - sys-ctl-rpr-docker-hard
  when: SYS_SVC_DOCKER_LOAD_SERVICES | bool