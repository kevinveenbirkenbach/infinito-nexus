{% if applications | get_app_conf(application_id, 'features.oauth2', False) %}
  oauth2-proxy:
    image: quay.io/oauth2-proxy/oauth2-proxy:{{ applications['web-app-oauth2-proxy'].version }}
    restart: {{ DOCKER_RESTART_POLICY }}
    command: --config /oauth2-proxy.cfg
    container_name: {{ application_id | get_entity_name }}-oauth2-proxy
    hostname: oauth2-proxy
    ports:
      - 127.0.0.1:{{ ports.localhost.oauth2_proxy[application_id] }}:4180/tcp
    volumes:
      - "{{ docker_compose.directories.volumes }}{{ applications | get_app_conf('web-app-oauth2-proxy','configuration_file')}}:/oauth2-proxy.cfg"
    healthcheck:
      test: ["CMD", "/bin/oauth2-proxy", "--version"]
      interval: 30s
      timeout: 5s
      retries: 1
      start_period: 5s
{% endif %}