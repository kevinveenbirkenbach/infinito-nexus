# @See https://docs.nextcloud.com/server/latest/admin_manual/configuration_user/user_auth_ldap.html
# @See https://chatgpt.com/c/67aa2d21-cb4c-800f-b1be-8629b6bd3f55

- name: Set Nextcloud LDAP bind password
  command: >
    {{ NEXTCLOUD_DOCKER_EXEC_OCC }} ldap:set-config s01 ldapAgentPassword "{{ LDAP.BIND_CREDENTIAL }}"
  no_log: "{{ MASK_CREDENTIALS_IN_LOGS | bool }}"

- name: Warm LDAP cache (to guaranty that all LDAP users are present)
  command: >
    {{ NEXTCLOUD_DOCKER_EXEC_OCC }} ldap:search ""
  async: "{{ ASYNC_TIME if ASYNC_ENABLED | bool else omit }}"
  poll:  "{{ ASYNC_POLL if ASYNC_ENABLED | bool else omit }}"
