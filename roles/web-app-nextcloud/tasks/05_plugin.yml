- block:
    - include_tasks: 06_plugin_routines.yml
  when: plugin_value.enabled | bool

- name: disable {{ plugin_key }} nextcloud plugin
  command: "{{ nextcloud_docker_exec_occ }} app:disable {{ plugin_key }}"
  register: disable_result
  failed_when: >
    (disable_result.rc | int != 0)
    and ('No such app enabled' not in (disable_result.stdout | default('') ~ disable_result.stderr | default('')))
  changed_when: >
    ((disable_result.stdout | default('') ~ disable_result.stderr | default('')) is search('disabled'))
    and (((disable_result.stdout | default('') ~ disable_result.stderr | default('')) is not search('already disabled')))
  when: not (plugin_value.enabled | bool)
