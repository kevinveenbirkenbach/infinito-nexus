- name: Ensure Nextcloud administrator is in the 'admin' group
  command: >
    {{ BIN_CONTAINER }} exec -u {{ NEXTCLOUD_DOCKER_USER }} {{ NEXTCLOUD_CONTAINER }}
    php occ group:adduser admin {{ NEXTCLOUD_ADMINISTRATOR_USERNAME }}
  register: add_admin_to_group
  changed_when: "not ASYNC_ENABLED and 'Added user' in (add_admin_to_group.stdout | default(''))"
  failed_when: >
    not ASYNC_ENABLED and
    (add_admin_to_group.rc != 0) and
    ("is already a member of" not in (
      (add_admin_to_group.stderr | default('')) ~ (add_admin_to_group.stdout | default(''))
    ))
  async: "{{ ASYNC_TIME if ASYNC_ENABLED | bool else omit }}"
  poll:  "{{ ASYNC_POLL if ASYNC_ENABLED | bool else omit }}"
