- name: Update DB host
  command: >
    container exec --user root {{ MATOMO_NAME }}
    sed -i "s/^host *=.*/host = {{ lookup('database', application_id, 'host') | sed_escape('/') }}/" {{ MATOMO_CONFIG }}
  notify: docker compose up

- name: Update DB name
  command: >
    container exec --user root {{ MATOMO_NAME }}
    sed -i "s/^dbname *=.*/dbname = {{ lookup('database', application_id, 'name') | sed_escape('/') }}/" {{ MATOMO_CONFIG }}
  notify: docker compose up

- name: Update DB user
  command: >
    container exec --user root {{ MATOMO_NAME }}
    sed -i "s/^username *=.*/username = {{ lookup('database', application_id, 'username') | sed_escape('/') }}/" {{ MATOMO_CONFIG }}
  notify: docker compose up

- name: Update DB password
  command: >
    container exec --user root {{ MATOMO_NAME }}
    sed -i "s/^password *=.*/password = {{ lookup('database', application_id, 'password') | sed_escape('/') }}/" {{ MATOMO_CONFIG }}
  no_log: "{{ MASK_CREDENTIALS_IN_LOGS | bool }}"
  notify: docker compose up
