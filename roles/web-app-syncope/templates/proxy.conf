server
{
  server_name {{ domain }};
  {# Include buffers for OIDC #}
  {% include 'roles/sys-svc-proxy/templates/headers/buffers.conf.j2' %}

  {% if applications | get_app_conf(application_id, 'docker.services.oauth2.enabled', False) %}
    {% include 'roles/web-app-oauth2-proxy/templates/endpoint.conf.j2'%}
  {% endif %}

  {% include 'roles/sys-front-inj-all/templates/server.conf.j2'%}
  
  {% if webserver_extra_configuration is defined %}
    {# Additional Domain Specific Configuration #}
    {{ webserver_extra_configuration }}
  {% endif %}

  {% include 'roles/sys-front-tls/templates/nginx_ssl_header.j2' %}

  {% for path in syncope_paths.values() %}
    {% set location =  applications | tls_web_protocol(application_id, TLS_ENABLED) ~ '://' ~ domains | get_domain(application_id) ~ '/' ~ path ~ '/' %}
    {% include 'roles/sys-svc-proxy/templates/location/html.conf.j2'%}
  {% endfor %}
}