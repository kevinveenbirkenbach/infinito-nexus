- name: Load former meta dependencies once
  block:
  - name: Include moved dependency 'sys-lock'
    include_role:
      name: sys-lock
  - set_fact:
      run_once_update_docker: true
  when: run_once_update_docker is not defined
- name: "start sys-bkp-docker-2-loc-everything.infinito.service"
  systemd:
    name: sys-bkp-docker-2-loc-everything.infinito.service
    state: started
  when:
  - mode_backup | bool

- name: create {{update_docker_script}}
  template:
    src: update-docker.py.j2
    dest: "{{update_docker_script}}"

- name: configure update-docker.infinito.service
  template:
    src: update-docker.service.j2
    dest: /etc/systemd/system/update-docker.infinito.service

- name: "restart update-docker.infinito.service"
  systemd:
    name: update-docker.infinito.service
    state: restarted
    enabled: yes
    daemon_reload: yes
