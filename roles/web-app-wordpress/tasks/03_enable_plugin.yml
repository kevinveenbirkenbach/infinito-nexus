---
- name: "Check if plugin has a dedicated install task under '{{ plugin_task_path }}'"
  stat:
    path: "{{ plugin_task_path }}"
  register: plugin_task_file
  delegate_to: localhost
  become: false

- name: "Include plugin-specific install task if it exists"
  include_tasks: "{{ plugin_task_path }}"
  when: plugin_task_file.stat.exists

- name: "Install and activate WordPress plugin via WP CLI"
  command: >
    docker-compose exec -u www-data -T application
      wp plugin install {{ plugin_name }} --activate
      --path={{ WORDPRESS_DOCKER_HTML_PATH }}
  args:
    chdir: "{{ lookup('docker', application_id, want='directories.instance') }}"
