# General
application_id:                   "web-app-peertube"
entity_name:                      "{{ application_id | get_entity_name }}"

# Role variables
PEERTUBE_VERSION:                 "{{ lookup('config',application_id, 'docker.services.peertube.version') }}"
PEERTUBE_IMAGE:                   "{{ lookup('config',application_id, 'docker.services.peertube.image') }}"
PEERTUBE_CONTAINER:               "{{ lookup('config',application_id, 'docker.services.peertube.name') }}"
PEERTUBE_DATA_VOLUME:             "{{ lookup('config',application_id, 'docker.volumes.data') }}"
PEERTUBE_CONFIG_VOLUME:           "{{ lookup('config',application_id, 'docker.volumes.config') }}"

# OIDC
PEERTUBE_OIDC_PLUGIN:             "peertube-plugin-auth-openid-connect"
PEERTUBE_OIDC_ENABLED:            "{{ lookup('config',application_id, 'docker.services.oidc.enabled') }}"

# Performance
PEERTUBE_CPUS:                    "{{ lookup('config',application_id, 'docker.services.peertube.cpus') | float }}"
PEERTUBE_MAX_OLD_SPACE_SIZE:      "{{ applications | node_max_old_space_size(application_id, entity_name) }}"
_peertube_concurrency_candidate:  "{{ ((PEERTUBE_CPUS | float) * 0.5) | round(0, 'floor') | int }}"
PEERTUBE_TRANSCODING_CONCURRENCY: "{{ [ ( [ (_peertube_concurrency_candidate | int), 1 ] | max ), 8 ] | min }}"
