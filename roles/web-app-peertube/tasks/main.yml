---
- name: "include _create-domains.yml for peertube"
  include_tasks: _create-domains.yml
  loop: "{{ domains[application_id] }}"
  loop_control:
    loop_var: domain
  vars:
    # Websockt and http listen to the same port
    http_port:  "{{ ports.localhost.http[application_id] }}"
    webserver_websocket_port:    "{{ ports.localhost.http[application_id] }}"

- name: "load docker and db for {{ application_id }}"
  include_role:
    name: sys-stk-backend
  vars:
    docker_compose_flush_handlers: true

- name: "Install and activate auth-openid-connect plugin if OIDC is enabled"
  include_tasks: 01_enable-oidc.yml
  when: PEERTUBE_OIDC_ENABLED | bool

- name: "Deinstall and disable auth-openid-connect plugin if OIDC is enabled"
  include_tasks: 02_disable-oidc.yml
  when: not PEERTUBE_OIDC_ENABLED | bool
