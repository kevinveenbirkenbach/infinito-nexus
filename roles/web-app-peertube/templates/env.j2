# Database / Postgres service configuration
POSTGRES_USER={{ lookup('database', application_id, 'username') }}
POSTGRES_PASSWORD={{ lookup('database', application_id, 'password') | dotenv_quote }}
POSTGRES_DB={{ lookup('database', application_id, 'name') }}
PEERTUBE_DB_USERNAME={{ lookup('database', application_id, 'username') }}
PEERTUBE_DB_PASSWORD={{ lookup('database', application_id, 'password') | dotenv_quote }}
PEERTUBE_DB_SSL=false
PEERTUBE_DB_HOSTNAME={{ lookup('database', application_id, 'host') }}

# PeerTube server configuration
PEERTUBE_WEBSERVER_HOSTNAME={{ lookup('domain',application_id) }}
PEERTUBE_TRUST_PROXY=["127.0.0.1", "loopback"]

PEERTUBE_SECRET={{ applications | get_app_conf(application_id, 'credentials.secret')}}

{% if SYSTEM_EMAIL_ENABLED | bool %}
# E-mail configuration
PEERTUBE_SMTP_USERNAME={{ users['no-reply'].email }}
PEERTUBE_SMTP_PASSWORD={{ users['no-reply'].tokens['web-app-mailu'] | dotenv_quote }}
PEERTUBE_SMTP_HOSTNAME={{ SYSTEM_EMAIL_HOST }}
PEERTUBE_SMTP_PORT={{ SYSTEM_EMAIL_PORT }}
PEERTUBE_SMTP_FROM={{ users['no-reply'].email }}
PEERTUBE_SMTP_TLS={{ SYSTEM_EMAIL_TLS | lower }}
PEERTUBE_SMTP_DISABLE_STARTTLS={{ 'false' if SYSTEM_EMAIL_START_TLS else 'true' }}
{% endif %}

PEERTUBE_ADMIN_EMAIL={{ users['no-reply'].email }}