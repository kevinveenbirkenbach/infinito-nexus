{# This template needs to be included in docker-compose.yml #}
networks:
{# Central RDMS-Database Network #}
{% if 
  (
    applications | get_app_conf(application_id, 'docker.services.database.enabled', False) and 
    lookup('database', application_id, 'shared')
  )
  or
  application_id in ['svc-db-mariadb','svc-db-postgres']
%}
  {{ applications | get_app_conf(lookup('database', application_id, 'id'), 'docker.network') }}:
    external: true
{% endif %}
{# Central LDAP Network #}
{% if 
  applications | get_app_conf(application_id, 'docker.services.ldap.shared', False) and 
  applications | get_app_conf('svc-db-openldap', 'network.docker', False)
  %}
  {{ lookup('config','svc-db-openldap', 'docker.network') }}:
    external: true
{% endif %}
{# Central AI Network #}
{% if applications | get_app_conf(application_id, 'docker.services.ollama.shared', False) %}
  {{ lookup('config','svc-ai-ollama', 'docker.network') }}:
    external: true
{% endif %}
{# Default Network #}
{% if not application_id.startswith('svc-db-') and not application_id.startswith('svc-ai-') %}
  default:
{% if
  application_id in networks.local and 
  networks.local[application_id].subnet is defined
%}
    name: {{ application_id | get_entity_name }}
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: {{ networks.local[application_id].subnet }}
{% endif %}
{% endif %}
{{ "\n" }}
