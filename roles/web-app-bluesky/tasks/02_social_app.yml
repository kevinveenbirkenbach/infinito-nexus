- name: clone social app repository
  git:
    repo: "https://github.com/bluesky-social/social-app.git"
    dest: "{{ BLUESKY_SOCIAL_APP_DIR }}"
    version: "main"
    force: true
  notify:
    - docker compose up
    - docker compose build

- name: Force BAPP_CONFIG_URL to same-origin /config
  ansible.builtin.replace:
    path: "{{ BLUESKY_SOCIAL_APP_DIR }}/src/state/geolocation.tsx"
    regexp: '^\s*const\s+BAPP_CONFIG_URL\s*=\s*.*$'
    replace: "const BAPP_CONFIG_URL = '/config'"
  notify:
    - docker compose build
    - docker compose up
