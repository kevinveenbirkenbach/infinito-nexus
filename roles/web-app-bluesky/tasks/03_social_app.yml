- name: clone social app repository
  git:
    repo:     "https://github.com/bluesky-social/social-app.git"
    dest:     "{{ BLUESKY_SOCIAL_APP_DIR }}"
    version:  "main"
    force:    true
  notify:
    - compose up
    - compose build

- name: Force BAPP_CONFIG_URL to same-origin /config
  ansible.builtin.replace:
    path: "{{ BLUESKY_GEOLOCATION_PATH }}"
    regexp: '^\s*const\s+BAPP_CONFIG_URL\s*=\s*.*$'
    replace: "const BAPP_CONFIG_URL = '/config'"

- name: Force IPCC_URL to same-origin /ipcc
  ansible.builtin.replace:
    path: "{{ BLUESKY_GEOLOCATION_PATH }}"
    regexp: '^\s*const\s+IPCC_URL\s*=\s*.*$'
    replace: "const IPCC_URL = '/ipcc'"
