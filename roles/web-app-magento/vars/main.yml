# General
application_id:                 "web-app-magento"

# Magento (application container)

## Meta
MAGENTO_VOLUME:                 "{{ applications | get_app_conf(application_id, 'docker.volumes.data') }}"
MAGENTO_USER:                   "app"

## Address
MAGENTO_DOMAIN:                 "{{ domains | get_domain(application_id) }}"
MAGENTO_URL:                    "{{ lookup('tls_resolve', application_id, want='url.base') }}"

## Runtime config paths (used by 02_runtime_conf.yml)
# Root config directory comes from the docker_compose subsystem (already asserted)
MAGENTO_NGINX_DIR:              "{{ [ lookup('docker', application_id, 'directories.config'), 'nginx' ] | path_join }}"
MAGENTO_PHP_DIR:                "{{ [ lookup('docker', application_id, 'directories.config'), 'php' ]   | path_join }}"
MAGENTO_NGINX_CONF_PATH:        "{{ [ MAGENTO_NGINX_DIR, 'nginx.conf' ] | path_join }}"
MAGENTO_PHP_ZZ_CONF_PATH:       "{{ [ MAGENTO_PHP_DIR, 'php-fpm-zz-docker.conf' ] | path_join }}"

## Intra-container wiring (nginx -> php-fpm) and listen port
# These values mirror the docker-compose template (environment variables and exposed port)
MAGENTO_PHP_HOST:               "php"
MAGENTO_PHP_PORT:               9000
MAGENTO_NGINX_PORT:             8000

## Search (OpenSearch)
MAGENTO_SEARCH_VERSION:         "{{ applications | get_app_conf(application_id, 'docker.services.search.version') }}"
MAGENTO_SEARCH_IMAGE:           "{{ applications | get_app_conf(application_id, 'docker.services.search.image') }}"
MAGENTO_SEARCH_CONTAINER:       "{{ applications | get_app_conf(application_id, 'docker.services.search.name') }}"

## PHP
MAGENTO_PHP_VERSION:            "{{ applications | get_app_conf(application_id, 'docker.services.php.version') }}"
MAGENTO_PHP_IMAGE:              "{{ applications | get_app_conf(application_id, 'docker.services.php.image') }}"
MAGENTO_PHP_CONTAINER:          "{{ applications | get_app_conf(application_id, 'docker.services.php.name') }}"

## NGINX
MAGENTO_NGINX_VERSION:          "{{ applications | get_app_conf(application_id, 'docker.services.nginx.version') }}"
MAGENTO_NGINX_IMAGE:            "{{ applications | get_app_conf(application_id, 'docker.services.nginx.image') }}"
MAGENTO_NGINX_CONTAINER:        "{{ applications | get_app_conf(application_id, 'docker.services.nginx.name') }}"

## Credentials
MAGENTO_REPO_PUBLIC_KEY:        "{{ applications | get_app_conf(application_id, 'credentials.adobe_public_key') }}"
MAGENTO_REPO_PRIVATE_KEY:       "{{ applications | get_app_conf(application_id, 'credentials.adobe_private_key') }}"
