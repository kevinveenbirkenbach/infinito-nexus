- name: Include dependency 'dev-python-pip'
  include_role:
    name: dev-python-pip
  when: run_once_dev_python_pip is not defined

- name: Install or upgrade baudolo system-wide via pip (force system pip)
  ansible.builtin.command:
    argv:
      - /usr/bin/pip3
      - install
      - -U
      - --break-system-packages
      - backup-docker-to-local
  environment:
    PIP_BREAK_SYSTEM_PACKAGES: "1"
  changed_when: true

- name: Assert required baudolo commands are available
  ansible.builtin.command: "which {{ item }}"
  loop:
    - baudolo
    - baudolo-seed
  register: baudolo_cmd_check
  changed_when: false
  failed_when: baudolo_cmd_check.rc != 0
  when: MODE_ASSERT | bool
